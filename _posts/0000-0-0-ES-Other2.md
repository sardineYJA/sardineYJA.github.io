---
layout: post
title: "ES 补充"
date: 2020-05-06
description: "Elasticsearch"
tag: Elasticsearch

---

## 安装searchguard关闭xpack部分功能

```sh
xpack.monitoring.enabled: true
xpack.security.enabled: false   
xpack.graph.enabled: false
xpack.ml.enabled: false
xpack.watcher.enabled: false
```

## Kibana

需要安装search-guard-kibana-plugin

```sh
server.host: XXX.XXX.XXX.XXX
elasticsearch.url: "http://XXX.XXX.XXX.XXX:9200"
elasticsearch.username: "admin"
elasticsearch.password: "admin"

xpack.monitoring.enabled: true
xpack.security.enabled: false        # xpack的 安全机制
xpack.reporting.enabled: false       # xpack的 报告机制
searchguard.session.keepalive: false
```

## 换GC

```sh
-XX:+UseG1GC
-XX:MaxGCPauseMillis=300
```

## 查询特殊符号命名的index

转义字符用：%
例如：
```sh
# GET /<logstash-{now/d}>/_search
GET /%3Clogstash-%7Bnow%2Fd%7D%3E/_search
```

端口：lsof -i :5601   # 查看kibana进程


## Important Elasticsearch configuration

- path.data and path.logs
- cluster.name
- node.name
- bootstrap.memory_lock
- network.host
- discovery.zen.ping.unicast.hosts
- discovery.zen.minimum_master_nodes
- JVM heap dump path

## Important System Configuration

- Set JVM heap size
- Disable swapping
- Increase file descriptors
- Ensure sufficient virtual memory
- Ensure sufficient threads


## Reindex

yml配置：
```sh
reindex.remote.whitelist: "XXX.XXX.XXX.XXX:9200"
```

获取原模板：`GET _template`，修改refresh_interval为-1，number_of_replicas为0

```sh
POST _reindex
{

  "size": 5,
  "conflicts": "proceed",

  "source": {
    "remote": {
      "host": "http://oldhost:9200",
      "username": "user",
      "password": "pass"
    },

    "size": 2,      # 每批次量
    "index": "oldIndex",
    "type": "",
    "_source": ["name"],
    "query": {
      "match": {
        "test": "data"
      }
    }
  },

  "dest": {
    "index": "newIndex",       # 新索引
    "op_type": "create",       # 操作类型创建
    "routing": "=value"        # 以什么值为路由
  }
}
```





