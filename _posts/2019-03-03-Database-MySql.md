---
layout: post
title: "MySQL 数据库"
date: 2019-03-03
description: "简单介绍MySQL"
tag: Database

---

## 存储引擎

* MyISAM管理非事务表。它提供高速存储和检索，以及全文搜索能力。如果应用中需要`执行大量的SELECT查询`，那么MyISAM是更好的选择。

* InnoDB用于事务处理应用程序，具有众多特性，包括ACID事务支持。如果应用中需要`执行大量的INSERT或UPDATE操作`，则应该使用InnoDB，这样可以提高多用户并发操作的性能。


特性：

事务：InnoDB 是事务型的，可以使用 Commit 和 Rollback 语句。

并发：MyISAM 只支持表级锁，而 InnoDB 还支持行级锁。（Innodb采用的是行锁，采用了多版本并发控制来提高读操作的性能。每一行记录的后面增加两个隐藏列，创建版本号和删除版本号）

外键：InnoDB 支持外键。

备份：InnoDB 支持在线热备份。

崩溃恢复：MyISAM 崩溃后发生损坏的概率比 InnoDB 高很多，而且恢复的速度也更慢。

其它特性：MyISAM 支持压缩表和空间数据索引。


## 事务 ACID

* 原子性（Atomicity）务被视为不可分割的最小单元，事务的所有操作要么全部提交成功，要么全部失败回滚。回滚可以用日志来实现，日志记录着事务所执行的修改操作，在回滚时反向执行这些修改操作即可。

* 一致性（Consistency）数据库在事务执行前后都保持一致性状态。在一致性状态下，所有事务对一个数据的读取结果都是相同的。

* 隔离性（Isolation）一个事务所做的修改在最终提交以前，对其它事务是不可见的。

* 持久性（Durability）一旦事务提交，则其所做的修改将会永远保存到数据库中。即使系统发生崩溃，事务执行的结果也不能丢失。


## 数据库隔离级别

1. 未提交读（READ UNCOMMITTED）事务中的修改，即使没有提交，对其它事务也是可见的。这样会提高性能，但是会导致脏读问题。

2. 提交读（READ COMMITTED）一个事务只能读取已经提交的事务所做的修改。换句话说，一个事务所做的修改在提交之前对其它事务是不可见的。该级别可以解决脏读为问题，但不能避免不可重复读。

3. 可重复读（REPEATABLE READ）保证在同一个事务中多次读取同样数据的结果是一样的。可以解决不可重复读的问题，但还是不能避免幻读的问题。

4. 可串行化（SERIALIZABLE）强制事务串行执行，可以解决所有问题，最高级别的隔离。

`MySQL默认的隔离级别是可重复读`


并发一致性问题：

* 丢失修改：T1 和 T2 两个事务都对一个数据进行修改，T1 先修改，T2 随后修改，T2 的修改覆盖了 T1 的修改。

* 脏读数据：T1 修改一个数据，T2 随后读取这个数据。如果 T1 撤销了这次修改，那么 T2 读取的数据是脏数据。

* 不可重复读：T2 读取一个数据，T1 对该数据做了修改。如果 T2 再次读取这个数据，此时读取的结果和第一次读取的结果不同。

* 幻读：T1 读取某个范围的数据，T2 在这个范围内插入新的数据，T1 再次读取这个范围的数据，此时读取的结果和和第一次读取的结果不同。


## 锁的分类

* 乐观锁一般是指用户自己实现的一种锁机制。

* 悲观锁：它对于数据被外界修改持保守态度，认为数据随时会修改，所以整个数据处理中需要将数据加锁。悲观锁一般都是依靠关系数据库提供的锁机制，事实上关系数据库中的行锁，表锁不论是读写锁都是悲观锁。


## drop、delete、truncate

* Delete用来删除表的全部或者一部分数据行，执行delete之后，用户需要提交(commmit)或者回滚(rollback)来执行删除或者撤销删除，delete命令会触发这个表上所有的delete触发器。

* Truncate删除表中的所有数据，这个操作不能回滚，也不会触发这个表上的触发器，TRUNCATE比delete更快，占用的空间更小。

* Drop命令从数据库中删除表，所有的数据行，索引和权限也会被删除，所有的DML触发器也不会被触发，这个命令也不能回滚。

因此，在不再需要一张表的时候，用drop；在想删除部分数据行时候，用delete；在保留表而删除所有数据的时候用truncate。


## 临时表

外部临时表：

通过CREATE TEMPORARY TABLE 创建的临时表，这种临时表称为外部临时表。这种临时表只对当前用户可见，当前会话结束的时候，该临时表会自动关闭。这种临时表的命名与非临时表可以同名（同名后非临时表将对当前会话不可见，直到临时表被删除）。

 
内部临时表：

内部临时表是一种特殊轻量级的临时表，用来进行性能优化。这种临时表会被MySQL自动创建并用来存储某些操作的中间结果。这些操作可能包括在优化阶段或者执行阶段。这种内部表对用户来说是不可见的，但是通过EXPLAIN或者SHOW STATUS可以查看MYSQL是否使用了内部临时表用来帮助完成某个操作。



# reference

https://www.cnblogs.com/domi22/p/8538628.html

https://blog.csdn.net/snowbaby1234/article/details/81238760
